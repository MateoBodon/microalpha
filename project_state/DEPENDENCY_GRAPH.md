# Dependency Graph (textual)

Arrows mean "imports from".

- **cli.py** → `runner`, `walkforward`, `reporting.summary`, `reporting.tearsheet`, `importlib.metadata`.
- **runner.py** → `config`, `data`, `engine`, `portfolio`, `execution`, `broker`, `manifest`, `logging`, `market_metadata`, `metrics`, `risk`, `slippage`, `capital`, `strategies.*`, `yaml`, `numpy`, `pandas`.
- **walkforward.py** → `config`, `config_wfv`, `data`, `engine`, `portfolio`, `execution`, `broker`, `manifest`, `logging`, `market_metadata`, `metrics`, `risk_stats`, `runner` helpers (`persist_*`, `resolve_*`), `strategies.*`, `numpy`, `pandas`, `yaml`.
- **engine.py** → `events`.
- **portfolio.py** → `events`, `logging.JsonlWriter`, `market_metadata.SymbolMeta`, capital policy interface (`capital`), data handler methods for price/volume lookup.
- **execution.py** → `events`, `lob`, `slippage`, `market_metadata.SymbolMeta`, `numpy`.
- **lob.py** → `events`, `numpy`.
- **slippage.py** → `market_metadata.SymbolMeta`, `math`.
- **capital.py** → `numpy`, relies on data handler lookups defined in `Portfolio`.
- **allocators.py** → `numpy`, `pandas`.
- **risk_stats.py** → `numpy`, `pandas`.
- **risk.py** → `risk_stats`.
- **metrics.py** → `risk_stats`, `numpy`, `pandas`, `os` for HAC env override.
- **manifest.py** → `numpy`, `pandas`, `random`, `platform`, `subprocess`, `importlib.metadata`.
- **logging.py** → stdlib `json`, `os`.
- **market_metadata.py** → `pandas`.
- **strategies.meanrev/breakout/mm** → `events`.
- **strategies.cs_momentum** → `events`, `pandas`.
- **strategies.flagship_mom** → `allocators.budgeted_allocator`, `events`, `numpy`, `pandas`.
- **reporting.summary** → `pandas`, stdlib `json/os/Path`, optional `reporting.factors.compute_factor_regression`.
- **reporting.tearsheet** → `matplotlib`, `numpy`, `pandas`, stdlib `json`.
- **reporting.factors** → `numpy`, `pandas`.
- **reporting.analytics** → `numpy`, `pandas`, `matplotlib`.
- **reporting.spa** → `numpy`, `pandas`.
- **reporting.wrds_summary** → `matplotlib`, `yaml`, stdlib `json/shutil/os`; consumes outputs of analytics/spa/tearsheet/factors.
- **wrds/__init__.py** → stdlib `os/pathlib`.
- **scripts**:
  - `augment_sp500.py` → `pandas`, processes raw data_sp500.
  - `build_flagship_universe.py` → `pandas`, uses enriched data and metadata.
  - `build_wrds_signals.py` → `pandas`, uses WRDS universe CSV.
  - `export_wrds_flagship.py` → `wrds` (external), `pandas`, `pyarrow`, `microalpha.wrds` for credential checks.
  - `plot_mm_spread.py` → `yaml`, `matplotlib`, `microalpha.runner`.

## Central Hubs
- `runner.py` and `walkforward.py` are orchestration hubs pulling together configs, data handlers, strategies, execution, metrics, and artifact persistence.
- `events.py` sits at the core of engine/portfolio/execution/strategy coupling.
- `reporting` modules depend on artifacts generated by runner/walkforward but do not feed back into the core engine.

## Notes on Coupling
- Strategies and allocators are decoupled via `STRATEGY_MAPPING` and parameter dictionaries; execution models chosen via `EXECUTION_MAPPING`.
- Walk‑forward reuses runner’s helper functions for artifact persistence to avoid duplication.
- No circular imports observed in the core; reporting stack is downstream‑only.
